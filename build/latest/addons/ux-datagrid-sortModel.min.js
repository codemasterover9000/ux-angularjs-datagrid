/*!
* ux-angularjs-datagrid v.1.6.8
* (c) 2018, Obogo
* https://github.com/obogo/ux-angularjs-datagrid
* License: MIT.
*/
(function (exports, global) {
if (typeof define === "function" && define.amd) {
  define(exports);
} else if (typeof module !== "undefined" && module.exports) {
  module.exports = exports;
} else {
  global.ux = exports;
}


!function(a,b){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&module.exports?module.exports=a:b.ux=a,a.datagrid.events.ON_BEFORE_SORT="datagrid:onBeforeSort",a.datagrid.events.ON_AFTER_SORT="datagrid:onAfterSort",a.datagrid.events.ON_BEFORE_TOGGLE_SORT="datagrid:onBeforeToggleSort",a.datagrid.events.ON_AFTER_TOGGLE_SORT="datagrid:onAfterToggleSort",a.datagrid.events.CLEAR_SORTS="datagrid:clearSorts",a.datagrid.events.CLEAR_ALL_SORTS="datagrid:clearAllSorts",angular.module("ux").factory("sortStatesModel",["$location","$rootScope",function(b,c){return a.datagrid.sortStatesModel=function(){function d(a){return"$"===a.charAt(0)}function e(){return b.path()}function f(){return F.getCurrentPath().split("?").shift()}function g(){var a;return a=F.getIgnoreParamsInPath()?F.getCurrentPathWithoutParams():F.getCurrentPath(),a!==H&&(F.log("getPath changed from %s to %s",H,a),H=a),a}function h(){var a=J[F.getPath()];return!0===a||!1===a?a:L}function i(a,b){return b=b||F.getPath(),void 0!==a&&(F.log("setAllowMultipleStates %s",a),J[b]=!0===a),!!J[b]}function j(){return!0===K[F.getCurrentPathWithoutParams()]}function k(a){F.log("setIgnoreParamsInPath %s",a),K[F.getCurrentPathWithoutParams()]=a}function l(a){return a=a||F.getPath(),!!I[a]}function m(a){return a=a||F.getPath(),I[a]||(I[a]={$dirty:!1,$path:a,$order:[]}),I[a]}function n(b){var c,e=F.getPathState();F.log("setPathState %s to %s",e,b),F.setIgnoreParamsInPath(!0);for(c in b)a.util.apply(Object.prototype.hasOwnProperty,b,[c])&&b[c]!==e[c]&&!d(c)&&F.setState(c,b[c],e)}function o(a){var b=F.getPathState(F.getPath());return void 0===b[a]&&(b[a]=G.NONE),b[a]}function p(a,b,c){var d,e;if(c=c||F.getPathState(F.getPath()),!F.isPrivate(a)&&c[a]!==b){if(e=c[a],F.getAllowMultipleStates(c.$path)&&-1!==(d=c.$order.indexOf(a))&&c.$order.splice(d,1),b!==G.NONE&&(F.getAllowMultipleStates()||F.clear(c),c.$order.push(a)),c[a]=b,!e&&b===G.NONE)return;F.dirtyState(c)}}function q(b){b=b||F.getPathState(F.getPath());var c={text:"",pathState:b};return a.each(b.$order,F.createKeyFromState,c),c.text}function r(a,b,c,d){F.isPrivate(a)||(d.text+=(d.text.length?"|":"")+a+":"+d.pathState[a])}function s(a){var b=F.getState(a),c=F.getNextState(b);F.info("toggle %s from %s to %s",a,b,c),F.setState(a,c),F.dirtyState()}function t(a){a=a||F.getPathState(F.getPath()),F.log("dirtyState %s",a),a.$dirty=!0}function u(a){a=a||F.getPathState(F.getPath()),F.log("clearDirty %s",a),a.$dirty=!1}function v(a){var b=G.ASC;switch(a){case G.NONE:b=G.ASC;break;case G.ASC:b=G.DESC;break;case G.DESC:b=G.NONE}return b}function w(a){return a=a||F.getPathState(F.getPath()),a.$dirty}function x(a){var b=void 0===a||null===a?"":a;return"string"==typeof b?b.toLowerCase():b}function y(){return"en"}function z(a,b){return a=F.cleanSortValue(a),b=F.cleanSortValue(b),a>b?1:a<b?-1:0}function A(a,b){return 0}function B(a){return function(b,c){var d=b[a],e=c[a];return F.customSorts&&F.customSorts[a]?F.customSorts[a](d,e,"asc",a,b,c):F.sortValueCompare(d,e)}}function C(a){return function(b,c){var d=b[a],e=c[a];return F.customSorts&&F.customSorts[a]?F.customSorts[a](d,e,"desc",a,b,c):-F.sortValueCompare(d,e)}}function D(b){var c;b=b||F.getPathState(F.getPath()),b.$order.length=0;for(c in b)a.util.apply(Object.prototype.hasOwnProperty,b,[c])&&!F.isPrivate(c)&&b[c]!==G.NONE&&(b[c]=G.NONE)}function E(){I={},J={}}var F=a.logWrapper("columnSortStatesModel",{},"blue",function(){a.util.apply(c.$emit,c,arguments)}),G={ASC:"asc",DESC:"desc",NONE:"none"},H="",I={},J={},K={},L=!1;return F.getPath=g,F.getCurrentPath=e,F.getCurrentPathWithoutParams=f,F.sortValueCompare=z,F.cleanSortValue=x,F.getNextState=v,F.createKeyFromState=r,F.getAllowMultipleStates=h,F.setAllowMultipleStates=i,F.getIgnoreParamsInPath=j,F.setIgnoreParamsInPath=k,F.hasPathState=l,F.getPathState=m,F.setPathState=n,F.getState=o,F.setState=p,F.toggle=s,F.dirtyState=t,F.clearDirty=u,F.sortNone=A,F.createAscSort=B,F.createDescSort=C,F.hasDirtySortState=w,F.createKeyFromStates=q,F.isPrivate=d,F.getLocale=y,F.clear=D,F.clearAll=E,F.sortOptions=G,F},a.datagrid.sortStatesModel}]),angular.module("ux").factory("sortModel",["sortStatesModel","$state",function(b,c){return["inst",function(d){function e(a,b,c){var d=c[b];return d&&k[b]&&ux.util.array.sort(a,k[b][d]),a}function f(a,b,c,d){var f,g;if(!m.groupSort&&d.grouped&&d.ary.length&&d.ary[0].hasOwnProperty(d.grouped))for(g=d.ary.length,f=0;f<g;f+=1)d.ary[f]=angular.extend({},d.ary[f]),d.ary[f][d.grouped]=e(d.ary[f][d.grouped].slice(0),a,d.pathState);else e(d.ary,a,d.pathState)}function g(){var a,b,c=o.hasPathState(),e=o.getPathState();if(m.sorts=m.sorts||d.options.sorts,m.sorts)for(a in m.sorts)"object"==typeof m.sorts[a]?(o.setState(a,m.sorts[a].value,e),b=m.sorts[a]):(c||o.setState(a,m.sorts[a],e),b={asc:o.createAscSort(a),desc:o.createDescSort(a),none:o.sortNone}),j.addSortColumn(a,b)}var h,i,j=a.logWrapper("sortModel",{},"blue",d),k={},l={},m=d.options.sortModel||{},n=d.name,o=c.current.sortStatesModels&&c.current.sortStatesModels[n];return o||(o=new b,o.getCurrentPath=function(){return n},c.current.sortStatesModels||(c.current.sortStatesModels={}),c.current.sortStatesModels[n]=o),j.addSortColumn=function(a,b){k[a]=b;var c=o.getPathState();o.customSorts=m.custom,c[a]=c[a]||o.sortOptions.NONE},j.getCache=function(a){return l[a]},j.setCache=function(a,b){l[a]=b},j.applySorts=function(b,c,e){var g=o.getPathState(),k=angular.copy(g);if(c&&(j.log("apply sortOptions"),o.setPathState(c)),h!==b||o.hasDirtySortState(g)){if(!(h=b))return i=h;if(e&&j.clear(),j.setCache("",h),!j.$processing){j.$processing=!0;var l,n=o.createKeyFromStates(g),p=angular.copy(g);j.info("applySorts %s",n),l=d.dispatch(a.datagrid.events.ON_BEFORE_SORT,n,k,p),l.defaultPrevented?i=h:(j.getCache(n)&&j.getCache(n).length===h.length?j.log("\tpull sort from cache"):(j.log("\tstore sort %s",n),j.setCache(n,h&&h.slice(0)||[]),ux.each(p.$order,f,{grouped:d.grouped,pathState:p,ary:j.getCache(n)})),i=j.getCache(n),o.clearDirty(g),!1===m.enableCache&&j.clear()),j.$processing=!1,d.dispatch(a.datagrid.events.ON_AFTER_SORT,n,p,k)}}return i},j.isApplied=function(a,b){return o.getPathState()[a]===b},j.getSortStateOf=function(a){return o.getPathState()[a]},j.multipleSort=o.setAllowMultipleStates,j.getSortKey=o.createKeyFromStates,j.toggleSort=function(b){j.log("toggleSort %s",b),d.dispatch(a.datagrid.events.ON_BEFORE_TOGGLE_SORT,b),d.creepRenderModel&&d.creepRenderModel.stop(),o.toggle(b),j.applySorts(h),d.dispatch(a.datagrid.events.ON_AFTER_TOGGLE_SORT,b)},j.setSortStateOf=function(a,b){"none"!==b&&"asc"!==b&&"desc"!==b||o.setState(a,b)},j.clear=function(){l={}},j.destroy=function(){j=null,i=null,k=null,l=null,h=null,d.sortModel=null,d=null},d.sortModel=j,g(),d}]}])}(this.ux=this.ux||{},function(){return this}());
//# sourceMappingURL=ux-datagrid-sortModel.min.js.map
}(this.ux = this.ux || {}, function() {return this;}()));
